进入战斗, 己方组5人 对方组5人 
actor类型: 玩家 BB 电脑 其他玩家

战斗指令: 物理攻击, 法术攻击(单法 群法 封印), 吃药, 特技, 加buff, 加debuff

1. 每回合倒计时30s
2. 每个玩家发出自己的战斗指令到服务器, 服务器接收每个玩家发出的战斗指令, 排序, 伤害计算. 下发. 计算回合总时间,下发.
3. 服务器倒计时回合时间, 时间到,进入下一个回合倒计时.
4. 客户端收到回合时间,还有完整的战斗指令后, 本地进行动画播放. 播放后,等待服务器下一个回合倒计时.
5. 服务器客户端之间的延时


客户端战斗表现设计

战斗环境：
PVP 最多5V5  每个Actor可以召唤自己的宝宝
PVE 最多5V10  对方是NPC 或者 普通Actor
战斗分两组 自己组（SelfActors）  对方组（EnemyActors）
回合制战斗机制：
1. 回合开始，倒计时等待战斗指令的输入
2. 战斗指令进行排序
3. 上一回合的战斗指令处理
4. 本回合战斗指令处理
5. 回合结束，进入下一个回合

#战斗指令

类型：
施法技能 ：物理施法，法术施法，特技施法，辅助施法
普通攻击
防御
召唤
捕捉

战斗指令队列
回合计数
              


master 攻击actor
target 攻击目标actor

hp +-	hp为0表示死亡 
sp +-	sp不足 不能释放特技
mp +-	mp不足 不能释放技能

攻击力  
防御力
灵力
速度
躲避

1. 攻击类

攻击类动画表现为 master移动到target进行攻击 

状态机阶段:
				非防御						防御
[普通攻击] 	   受击动作+普通受击效果		防御动作+防御效果							
[攻击类技能]   受击动作+技能受击效果		防御动作+技能受击效果  

				是否连击 是否暴击 是否吸血 
普通攻击 			Y 		Y		Y
攻击类技能					Y 		Y 



攻击类技能也包括暴击

普通攻击时, 如果对方处于防御状态, 伤害减半
普通攻击时, 有可能出现连击, 暴击, 吸血, 被反震, 被反击, 击飞目标, 击倒目标

攻击技能流程:

攻击者	待战 -> 跑去 -> 攻击       -> 跑回 ->  待战
受击者	待战              受击                    待战



2. 法术类

3. 法术攻击指令


技能表里的技能都是瞬时的 当前回合释放后处理
技能释放后,可能产生buff到target的身上,
每回合会对buff做统一处理 例如表现效果展示 , 计算血量 等等

每回合读完所有战斗指令 根据actor速度模拟战斗指令释放,计算结果
回合开始后,对战斗指令进行播放
回合结束, 只用退出播放就行了.


横扫千军 分解成 
	1. 横扫千军技能 2. 横扫千军buff 
	buff表现是玩家脚下踩风火轮 防御力减半 第二回合不能行动, 在横扫千军释放完把buff给加上, 
	buff被加上后 , 玩家脚踩风火轮, 第二回合 buff持续生效, 第二回合结束 buff更新 判断buff无效

后发制人 分解成
	1. 后发技能释放完 增加一个buff 
	2. 后发buff在第二个回合开始buff处理的时候, 控制actor进行后发2技能attack攻击, 然后buff被移除掉

横扫伤害计算
	释放横扫的回合前, 可以提前算出 横扫对目标造成的伤害 以及横扫自己消耗的hp


cmd = {
    master,
    target,
    skill_id
}

atk_skill = {
    type = 'atk',
    atk_anim = '',
    combo,
    group_kill,
    buff_id,
    base_damage,
    is_suck_blood,
    is_critical_atk,
}

cast_skill = {
    type = 'cast',
    cast_anim,
    buff_id
}

buff = {
    turn_count,
    curr_turn,
    buff_state_anim,
    buff_props
}


播放攻击指令

待战-> 跑去-> 攻击 -> 

SkillOnStart

SkillOnCombo

SkillOnGroupKill

SkillOnEnd

读取攻击技能id, 是否有combo , 是否是群秒, 是否产生暴击, 是否吸血, 攻击效果, 是否会添加buff
添加buff的话, 添加后 调用buffOnStart

-> 跑回 -> 结束


播放施法指令

待战-> Cast动作->
SkillOnStart 

SkillOnCombo

SkillOnGroupKill

SkillOnEnd

-> 待战


DT伤害十方无敌	2.46+ 0.0143 * i
ST伤害生死搏	1.976+ 0.0091 * i
LBC伤害气吞山河	1.99 + 0.02 * i
HS伤害金刚伏魔	2 + 0.02 * i
DF伤害六道轮回（白天）	1.46569 + 0.0092 * i
DF伤害六道轮回（夜晚）	2.3766+ 0.021073* i
PT伤害护法金刚	1.99 + 0.02 * i
NE伤害毒经	2.015 + 0.01 * i
PS伤害盘丝大法	2.5002 + 0.0089 * i
WZ伤害潇湘剑雨	1.48049 + 0.02009 * i
FC伤害磬龙灭法	1.9799 + 0.02019 * i
WDD伤害混元神功	1.96139 + 0.02039 * i
TG伤害天罡气	2.4612 + 0.02039 * i
SML伤害巫咒	2.0+ 0.01985 * i
MW伤害震天诀	1.98309 + 0.02019 * i
LG伤害破浪诀	2.0973 + 0.01899*i
防御	1 + 0.0138 * i
其他门派灵力	0.46639 + 0.0092 * i
PS灵力天外魔音	0.46639 + 0.0141 * i
DT命中无双一击	0.97 + 0.0203 * i
LBC命中法天象地	1.0 + 0.0099 * i
PS命中秋波暗送	3*i
TG气血傲世诀	i *0.003
（和强身术一个效果）
WZ魔法周易学	i *0.005
（和冥想一个效果）
SML魔法驭灵咒	1.9588999 + 0.0138 * i
其他门派躲避	2.1775 + 0.01839 * i
WDD速度秘影迷踪	i*0.3
NE速度清歌妙舞	请看解释！


atk_skill = {
    type = 'atk',
    combo,
    atk_anim = '',
    group_kill,
    buff_id,
    base_damage,
    is_suck_blood,
    is_critical_atk,
}

攻击指令
    如果group_kill , 则有group_kill个完整攻击流程
攻击流程
    每个攻击流程,如果有combo,则有combo次攻击动作
攻击动作
    每次攻击动作触发一次伤害,每次攻击有可能吸血,反震,反击,防御,播放攻击动画等.


attack = {
    master,
    target,
    skill_id,
}
->
if skill.group_kill > 0 
    generate group kill data
    kill {target, random target}
else
    kill target
end

kill :
if combo > 0 then
    combo attack
else
    attack
end

GroupAttack = {
    SingleAttack = {
        target,
        ComboAttack = {
            
        }
    }
}
attack_command = {
    skill_id,
    group_kill = {
        attack_process1 = {
            attack_action1 = {
                is_suck_blood,
                is_critical_atk,
                is_defend
            },
            attack_action2 = {
                is_suck_blood,
                is_critical_atk,
                is_defend
            },
        },
        attack_process2 = {
            attack_action1 = {
                is_suck_blood,
                is_critical_atk,
                is_defend
            },
            attack_action2 = {
                is_suck_blood,
                is_critical_atk,
                is_defend
            },
        }
    }
}

战斗中一个玩家的状态机表现:

刚开始是待战 玩家的战斗位置 移动速度 武器动画 人物动画 动作切换

待战->跑去-> 
攻击 
    
-> 跑回 -> 待战



客户端状态机 

待机->走动->待机

待战->(物理攻击)->待战

物理攻击:
1. 平砍
2. 连击
3. 群击

待战->受击->待战

待战->(法术攻击)->待战

法术攻击:

1. 单秒
2. 群秒

一个回合表演 对应一个command队列更新

command执行顺序由player速度决定

一个command对应于一个player表演

command有各种类型

攻击:


施法:

物理攻击 : 连击 暴击 吸血 单体攻击 群体攻击 受击动画
    普攻 
    法术物理攻击 

法术攻击 : 法术连击 法术暴击 单法 群法 受击动画


封印 : 单封 群封 无受击

辅助 : 加血 单加 群加

特技 : 

复杂动画:
后发制人
横扫千军
破釜沉舟
龙卷雨击
飞砂走石
漫天花雨
　普通打造
　　1、武器（打造技能满级时）
　　10级： 命中45 伤害40
　　20级： 命中80 伤害70
　　30级： 命中115 伤害100
　　40级： 命中150 伤害130
　　50级： 命中185 伤害160
　　60级： 命中220 伤害190
　　70级： 命中255 伤害220
　　80级： 命中290 伤害250
　　90级： 命中325 伤害280
　　100级： 命中360 伤害310
　　110级： 命中395 伤害340
　　120级： 命中430 伤害370
　　130级： 命中465 伤害400
　　140级： 命中500 伤害430
　　150级： 命中535 伤害460
　　可以看出每高10级，基础数值命中＋35，伤害＋30
　　2、铠甲或女衣（裁缝技能满级时）
　　10级： 防御25
　　20级： 防御40
　　30级： 防御55
　　40级： 防御70
　　50级： 防御85
　　60级： 防御100
　　70级： 防御115
　　80级： 防御130
　　90级： 防御145
　　100级： 防御160
　　110级： 防御175
　　120级： 防御190
　　130级： 防御205
　　140级： 防御220
　　150级： 防御235
　　可以看出每高10级，基础数值防御＋15
　　3、头盔或发钗（裁缝技能满级时）
　　10级： 防御10 魔法15
　　20级： 防御15 魔法25
　　30级： 防御20 魔法35
　　40级： 防御25 魔法45
　　50级： 防御30 魔法55
　　60级： 防御35 魔法65
　　70级： 防御40 魔法75
　　80级： 防御45 魔法85
　　90级： 防御50 魔法95
　　100级： 防御55 魔法105
　　110级： 防御60 魔法115
　　120级： 防御65 魔法125
　　130级： 防御70 魔法135
　　140级： 防御75 魔法145
　　150级： 防御80 魔法155
　　可以看出每高10级，基础数值防御＋5，魔法＋10 10级： 防御10 气血30
　　4、腰带（炼金技能满级时）
　　10级： 防御10 气血30
　　20级： 防御15 气血50
　　30级： 防御20 气血70
　　40级： 防御25 气血90
　　50级： 防御30 气血110
　　60级： 防御35 气血130
　　70级： 防御40 气血150
　　80级： 防御45 气血170
　　90级： 防御50 气血190
　　100级： 防御55 气血210
　　110级： 防御60 气血230
　　120级： 防御65 气血250
　　130级： 防御70 气血270
　　140级： 防御75 气血290
　　150级： 防御80 气血310
　　可以看出每高10级，基础数值防御＋5，气血＋20
　　5、项链（炼金技能满级时） 6、靴（炼金技能满级时）
　　10级： 灵力17
　　20级： 灵力29
　　30级： 灵力41
　　40级： 灵力53
　　50级： 灵力65
　　60级： 灵力77
　　70级： 灵力89
　　80级： 灵力101
　　90级： 灵力113
　　100级： 灵力125
　　110级： 灵力137
　　120级： 灵力149
　　130级： 灵力161
　　140级： 灵力173
　　150级： 灵力185
　　可以看出每高10级，基础数值灵力＋12 10级： 防御10 敏捷8
　　6、靴（炼金技能满级时）
　　10级： 防御10 敏捷8
　　20级： 防御15 敏捷11
　　30级： 防御20 敏捷14
　　40级： 防御25 敏捷17
　　50级： 防御30 敏捷20
　　60级： 防御35 敏捷23
　　70级： 防御40 敏捷26
　　80级： 防御45 敏捷29
　　90级： 防御50 敏捷32
　　100级： 防御55 敏捷35
　　110级： 防御60 敏捷38
　　120级： 防御65 敏捷41
　　130级： 防御70 敏捷44
　　140级： 防御75 敏捷47
　　150级： 防御80 敏捷50
　　可以看出每高10级，基础数值防御＋5，敏捷＋3
　　强化打造
　　1、强化武器（打造技能满级时） 2、强化铠甲或女衣（裁缝技能满级时）
　　10级：命中47 伤害42
　　20级：命中84 伤害73
　　30级：命中120 伤害105
　　40级：命中157 伤害136
　　50级：命中194 伤害168
　　60级：命中231 伤害199
　　70级：命中267 伤害231
　　80级：命中304 伤害262
　　90级：命中341 伤害294
　　100级：命中378 伤害325
　　110级：命中414 伤害357
　　120级：命中451 伤害388
　　130级：命中488 伤害420
　　140级：命中525 伤害451
　　150级：命中561 伤害483
　　2、强化铠甲或女衣（裁缝技能满级时）
　　10级：防御26
　　20级：防御42
　　30级：防御57
　　40级：防御73
　　50级：防御89
　　60级：防御105
　　70级：防御120
　　80级：防御136
　　90级：防御152
　　100级：防御168
　　110级：防御183
　　120级：防御199
　　130级：防御215
　　140级：防御231
　　150级：防御246
　　3、强化头盔或发钗（裁缝技能满级时） 4、强化腰带（炼金技能满级时）
　　10级：防御10 魔法15
　　20级：防御15 魔法26
　　30级：防御21 魔法36
　　40级：防御26 魔法47
　　50级：防御31 魔法57
　　60级：防御36 魔法68
　　70级：防御42 魔法78
　　80级：防御47 魔法89
　　90级：防御52 魔法99
　　100级：防御57 魔法110
　　110级：防御63 魔法120
　　120级：防御68 魔法131
　　130级：防御73 魔法141
　　140级：防御78 魔法152
　　150级：防御84 魔法162
　　4、强化腰带（炼金技能满级时）
　　10级：防御10 气血31
　　20级：防御15 气血52
　　30级：防御21 气血73
　　40级：防御26 气血94
　　50级：防御31 气血115
　　60级：防御36 气血136
　　70级：防御42 气血157
　　80级：防御47 气血178
　　90级：防御52 气血199
　　100级：防御57 气血220
　　110级：防御63 气血241
　　120级：防御68 气血262
　　130级：防御73 气血283
　　140级：防御78 气血304
　　150级：防御84 气血325
　　5、强化项链（炼金技能满级时） 6、强化靴（炼金技能满级时）
　　10级：灵力17
　　20级：灵力30
　　30级：灵力43
　　40级：灵力55
　　50级：灵力68
　　60级：灵力80
　　70级：灵力93
　　80级：灵力106
　　90级：灵力118
　　100级：灵力131
　　110级：灵力143
　　120级：灵力156
　　130级：灵力169
　　140级：灵力181
　　150级：灵力194
　　6、强化靴（炼金技能满级时）
　　10级：防御10 敏捷8
　　20级：防御15 敏捷11
　　30级：防御21 敏捷14
　　40级：防御26 敏捷17
　　50级：防御31 敏捷21
　　60级：防御36 敏捷24
　　70级：防御42 敏捷27
　　80级：防御47 敏捷30
　　90级：防御52 敏捷33
　　100级：防御57 敏捷36
　　110级：防御63 敏捷39
　　120级：防御68 敏捷43
　　130级：防御73 敏捷46
　　140级：防御78 敏捷49
　　150级：防御84 敏捷50
　　给个分呗 3Q+



八、修炼公式：
修炼后伤害加成公式：an=1.02^n *(a+250)-250 ，其中a为原始伤害，n为修炼级数（n≤20）
以原始伤害a=400为例，修炼10级(n=10)后，an=1.219*(400+250)-250=542.3，增幅35.6％；修炼20级(n=20)后，an=1.486*(400+250)-250=715.9，增幅79.0%。
封系成功率提高公式：an = a*1.02^n
修炼后伤害减成公式(防御、抗法)：an = 0.98^n *（a+250）-250
以原始伤害a=400为例，修炼10级(n=10)后an=281.1，减幅29.7%；修炼20级(n=20)后，an=183.9，减幅54.0%。
简评：1.02^20=1.486=148.6%，0.98^20=0.668=66.8%可见伤害和防御提升的效果是受控的，250和1.02/0.98都是调整因子，实现了公式的柔性。


十、固定伤害的法术公式：
普陀 五行术伤害=SKILL*3+50 ；紧箍咒伤害（每回合）=SKILL*1+10
龙宫 龙吟=SILL+10 ；减mp伤害＝（skill＋10）×0.8（霹雳三打提出更改）
地府 判官令=SKILL*3+75 ；毒伤害=初始对方气血最大值/10，持续SKILL*1
盘丝 勾魂=SKILL*3+对方当前HP*5% ；姐妹同心MP伤害=SKILL*5
摄魄=SKILL*3 吸取 SKILL*1.5自身补充
简评：因目前职业所限暂无研究。

十一、 梦幻各门派技能平均效果计算公式：
先作如下假设：
除去所有装备时的人物属性点数为 x （假设为力量）
除去所有装备的所对应的数值参数为 y （这里对应的就是伤害）
技能的等级为 z （所要计算的技能等级）
不同种族的对应资质初始属性为 a
不同种族的对应的能力初始属性为 b
所研究的属性和数值的关系是 f
那么得到每级技能的平均加成效果是：
每级技能的攻加成绝对值：(y-(x-a)*f-b)/z
每级技能的攻加成百分比：([y/{(x-a)*f+b}]-1)/z


封印

封印类法术成功率：

当技能等级小于对方等级时：

封法成功率={0.9^|技能等级-对方等级|}*60%

当技能等级大于对方等级时

封法成功率={0.98-0.38*0.975^(技能等级-对方等级)}

其中0.98几率上限系数，0.38表示几率的波动范围系数，0.975几率增加系数，0.9几率衰减系数。

修炼对封印的影响：

修炼影响=*（1±0.02）^|攻击方对应修炼等级-防御方对应修炼等级|-0.25*{1-（1±0.02）^|攻击方对应修炼等级-防御方对应修炼等级| }

由以上公式可以看出,基本的技能成功率为60%左右。当技能等级低于对方等级时，封印成功率由60%快速衰减。而技能等级高于对方等级时，随着技能等级的提高，每级别技能的增加效果越来越小，并存在几率上限。